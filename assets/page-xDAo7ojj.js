import{c as D,r as l,u as E,a as _,j as e}from"./index-DkWMjuHb.js";import{H as j}from"./Header-DPb4Nwfq.js";import{B as A}from"./Button-B4k9wJs-.js";import{W as $}from"./WhatsAppButton-B-vl6nZy.js";import{getAllVideos as C,getVideoById as T,updateUser as U}from"./database-DuIwEKn7.js";function H(){const{id:c}=D(),[t,y]=l.useState(null),[m,N]=l.useState([]),[n,p]=l.useState(null),[k,S]=l.useState(!0),[h,b]=l.useState(!1),o=E(),v=_();l.useEffect(()=>{(async()=>{var d;try{const r=localStorage.getItem("user");if(!r){o("/login");return}const i=JSON.parse(r);p(i);const{data:a}=await C();if(a){const x=a.sort((P,B)=>P.order_number-B.order_number);N(x)}if(c){const{data:x}=await T(c);x&&(y(x),b(((d=i.videos_progress)==null?void 0:d[c])||!1))}}catch(r){console.error("Erro ao carregar vídeo:",r)}finally{S(!1)}})()},[c,o]),l.useEffect(()=>{if(n&&t&&!h){const d=setTimeout(async()=>{try{const i={...n.videos_progress||{},[t.id]:!0},a={...n,videos_progress:i};p(a),b(!0),localStorage.setItem("user",JSON.stringify(a)),await U(n.id,{videos_progress:i}),v.success("Vídeo marcado como assistido","")}catch(r){console.error("Erro ao marcar vídeo como assistido:",r)}},3e3);return()=>clearTimeout(d)}},[n,t,h,v]);const w=()=>{localStorage.removeItem("user"),o("/login")},V=s=>{var d,r,i;return s.includes("youtube.com/watch?v=")?`https://www.youtube.com/embed/${(d=s.split("v=")[1])==null?void 0:d.split("&")[0]}`:s.includes("youtu.be/")?`https://www.youtube.com/embed/${(r=s.split("youtu.be/")[1])==null?void 0:r.split("?")[0]}`:s.includes("vimeo.com/")?`https://player.vimeo.com/video/${(i=s.split("vimeo.com/")[1])==null?void 0:i.split("?")[0]}`:(s.includes("/embed/")||s.includes("player.vimeo.com"),s)},I=()=>{if(!t)return null;const s=V(t.video_url);return e.jsx("iframe",{src:s,title:t.title,className:"w-full h-full",allowFullScreen:!0,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"})},u=m.findIndex(s=>String(s.id)===String(t==null?void 0:t.id)),f=u>0?m[u-1]:null,g=u<m.length-1?m[u+1]:null;return k?e.jsxs("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 25%, #10b981 50%, #ec4899 75%, #3b82f6 100%)",backgroundSize:"400% 400%",animation:"gradientShift 25s ease infinite"},children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-white drop-shadow-lg",style:{fontFamily:"Pacifico, serif"},children:"Carregando vídeo..."})]}),e.jsx("style",{children:`
          @keyframes gradientShift {
            0%   { background-position: 0% 50%; }
            25%  { background-position: 25% 50%; }
            50%  { background-position: 50% 50%; }
            75%  { background-position: 75% 50%; }
            100% { background-position: 100% 50%; }
          }
        `})]}):t?e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 25%, #10b981 50%, #ec4899 75%, #3b82f6 100%)",backgroundSize:"400% 400%",animation:"gradientShift 25s ease infinite"},children:[e.jsx(j,{user:n,onLogout:w,showBackButton:!0,onBack:()=>o("/videos")}),e.jsx("main",{className:"container mx-auto px-4 py-8 max-w-6xl relative z-10",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/30 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-red-600 to-pink-600 text-white p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>o("/videos"),className:"p-2 hover:bg-white/20 rounded-full transition-colors",children:e.jsx("i",{className:"ri-arrow-left-line text-2xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4 text-red-100",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-video-line mr-1"}),"Vídeo #",t.order_number]}),t.testament&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-bookmark-line mr-1"}),t.testament==="old"?"Antigo Testamento":"Novo Testamento"]}),t.is_new&&e.jsx("span",{className:"bg-orange-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"NOVIDADE"})]})]})]})})}),e.jsx("div",{className:"relative bg-black",children:e.jsx("div",{className:"aspect-video",children:I()})}),e.jsxs("div",{className:"p-6 md:p-8",children:[t.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-3",children:"Sobre este vídeo"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:t.description})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[f?e.jsxs("button",{onClick:()=>o(`/video/${f.id}`),className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold px-6 py-3 rounded-lg transition-all duration-300 whitespace-nowrap w-full md:w-auto flex items-center justify-center",title:`Anterior: ${f.title}`,children:[e.jsx("i",{className:"ri-arrow-left-s-line mr-2"}),"Vídeo Anterior"]}):e.jsx("div",{className:"w-full md:w-auto"}),e.jsxs("button",{onClick:()=>o("/videos"),className:"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold px-6 py-3 rounded-lg transition-all duration-300 whitespace-nowrap w-full md:w-auto flex items-center justify-center",children:[e.jsx("i",{className:"ri-video-line mr-2"}),"Todos os Vídeos"]}),g?e.jsxs("button",{onClick:()=>o(`/video/${g.id}`),className:"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold px-6 py-3 rounded-lg transition-all duration-300 whitespace-nowrap w-full md:w-auto flex items-center justify-center",title:`Próximo: ${g.title}`,children:["Próximo Vídeo",e.jsx("i",{className:"ri-arrow-right-s-line ml-2"})]}):e.jsx("div",{className:"w-full md:w-auto"})]})]})]})}),e.jsx($,{message:`Olá! Estou assistindo o vídeo "${t.title}" e gostaria de mais informações`}),e.jsx("footer",{className:"relative z-10 p-4 text-center",children:e.jsxs("p",{className:"text-white/80 text-sm",children:["© ",new Date().getFullYear()," Profeta de Deus Kids - Desenvolvido com ❤️ para as crianças"]})}),e.jsx("style",{children:`
        @keyframes gradientShift {
          0%   { background-position: 0% 50%; }
          25%  { background-position: 25% 50%; }
          50%  { background-position: 50% 50%; }
          75%  { background-position: 75% 50%; }
          100% { background-position: 100% 50%; }
        }
      `})]}):e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 25%, #10b981 50%, #ec4899 75%, #3b82f6 100%)",backgroundSize:"400% 400%",animation:"gradientShift 25s ease infinite"},children:[e.jsx(j,{user:n,onLogout:w,showBackButton:!0,onBack:()=>o("/videos")}),e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-4",style:{fontFamily:"Pacifico, serif"},children:"Vídeo não encontrado"}),e.jsx(A,{onClick:()=>o("/videos"),className:"bg-purple-500 hover:bg-purple-600 text-white",children:"Voltar para Vídeos"})]}),e.jsx("style",{children:`
          @keyframes gradientShift {
            0%   { background-position: 0% 50%; }
            25%  { background-position: 25% 50%; }
            50%  { background-position: 50% 50%; }
            75%  { background-position: 75% 50%; }
            100% { background-position: 100% 50%; }
          }
        `})]})}export{H as default};
