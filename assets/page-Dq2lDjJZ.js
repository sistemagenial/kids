import{j as e,r as d,u as E}from"./index-DkWMjuHb.js";import{H as I}from"./Header-DPb4Nwfq.js";import{P as y}from"./ProgressBar-DfiKX2Fs.js";import{getAllStories as U,updateUser as k}from"./database-DuIwEKn7.js";import"./Button-B4k9wJs-.js";function j({story:a,onRead:o,onToggleFavorite:i,isFavorite:p,isCompleted:u}){const b=a.image_url||`https://readdy.ai/api/search-image?query=$%7BencodeURIComponent%28%60beautiful%20childrens%20bible%20story%20illustration%20for%20$%7Bstory.title%7D%2C%20colorful%20and%20vibrant%2C%20child-friendly%20artwork%2C%20simple%20background%2C%20biblical%20scene%2C%20warm%20lighting%2C%20suitable%20for%20children%60%29%7D&width=400&height=300&seq=${a.id}&orientation=landscape`;return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 hover:border-purple-200 group cursor-pointer relative",onClick:o,children:[e.jsx("div",{className:"absolute top-3 left-3 w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 text-white rounded-full flex items-center justify-center text-lg font-bold shadow-lg z-10",children:a.order_number}),e.jsx("div",{className:"relative h-48 overflow-hidden",children:e.jsx("img",{src:b,alt:a.title,className:"w-full h-full object-cover object-top group-hover:scale-105 transition-transform duration-300",loading:"lazy"})}),a.is_new&&e.jsx("div",{className:"bg-gradient-to-r from-orange-400 to-orange-600 text-white text-center py-1 animate-pulse",children:e.jsx("span",{className:"text-xs font-bold tracking-wider",children:"NOVIDADE"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center",children:u?e.jsxs("div",{className:"flex items-center text-green-600 text-xs font-bold",children:[e.jsx("i",{className:"ri-check-circle-fill mr-1"}),e.jsx("span",{children:"LIDO"})]}):e.jsx("div",{className:"flex items-center text-red-500 text-xs font-bold",children:e.jsx("span",{children:"NÃO LIDO"})})}),i&&e.jsx("button",{onClick:f=>{f.stopPropagation(),i(a.id)},className:`p-2 rounded-full transition-all duration-300 hover:scale-110 ${p?"text-red-500 hover:text-red-600":"text-gray-400 hover:text-red-500"}`,children:e.jsx("i",{className:`${p?"ri-heart-fill":"ri-heart-line"} text-2xl`})})]}),e.jsx("h3",{className:"font-bold text-lg text-gray-800 text-center line-clamp-2 group-hover:text-purple-600 transition-colors",children:a.title})]})]})}function B(){const[a,o]=d.useState(null),[i,p]=d.useState([]),[u,b]=d.useState(""),[f,D]=d.useState(0),[n,c]=d.useState("all"),[S,_]=d.useState(!0),h=E();d.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("user");if(!s){h("/login");return}let r;try{r=JSON.parse(s)}catch(g){console.error("Failed to parse stored user data",g),h("/login");return}if(o(r),r.access_expires_at){const g=new Date(r.access_expires_at),l=new Date,O=g.getTime()-l.getTime(),T=Math.ceil(O/(1e3*60*60*24));D(Math.max(0,T))}const{data:x}=await U();x&&p(x)}catch(s){console.error("Erro ao carregar dados:",s)}finally{_(!1)}})()},[h]),d.useEffect(()=>{const t=s=>{if(s.detail.type==="stories"){if(!a)return;const r={...a,favorite_stories:s.detail.favorites};o(r),localStorage.setItem("user",JSON.stringify(r))}};return window.addEventListener("favoritesUpdated",t),()=>window.removeEventListener("favoritesUpdated",t)},[a]);const C=()=>{localStorage.removeItem("user"),h("/login")},w=async t=>{if(a)try{const s={...a.stories_progress,[t]:!0},r={...a,stories_progress:s};o(r),localStorage.setItem("user",JSON.stringify(r)),await k(a.id,{stories_progress:s})}catch(s){console.error("Erro ao atualizar progresso:",s)}finally{h(`/story/${t}`)}},v=async t=>{if(!a)return;const s=a.favorite_stories??[],x=s.includes(t)?s.filter(l=>l!==t):[...s,t],g={...a,favorite_stories:x};o(g),localStorage.setItem("user",JSON.stringify(g));try{const{data:l}=await k(a.id,{favorite_stories:x});l&&(o(l),localStorage.setItem("user",JSON.stringify(l)))}catch(l){console.error("Erro ao atualizar favoritos:",l),o(a),localStorage.setItem("user",JSON.stringify(a))}},F=async()=>{console.log("Renovação de plano acionada"),h("/renovar")},m=(()=>{let t=i.filter(s=>s.title.toLowerCase().includes(u.toLowerCase()));switch(n){case"read":t=t.filter(s=>{var r;return(r=a==null?void 0:a.stories_progress)==null?void 0:r[s.id]});break;case"unread":t=t.filter(s=>{var r;return!((r=a==null?void 0:a.stories_progress)!=null&&r[s.id])});break;case"new":t=t.filter(s=>s.is_new);break;case"favorites":t=t.filter(s=>{var r;return(r=a==null?void 0:a.favorite_stories)==null?void 0:r.includes(s.id)});break;case"old_testament":t=t.filter(s=>s.testament==="old");break;case"new_testament":t=t.filter(s=>s.testament==="new");break}return t})(),N=Object.entries((a==null?void 0:a.stories_progress)??{}).filter(([t,s])=>{const r=i.some(x=>x.id===t);return s&&r}).length;return a?S?e.jsxs("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 25%, #10b981 50%, #ec4899 75%, #3b82f6 100%)",backgroundSize:"400% 400%",animation:"gradientShift 25s ease infinite"},children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-white drop-shadow-lg",style:{fontFamily:"Pacifico, serif"},children:"Carregando histórias..."}),e.jsx("p",{className:"text-white/80 mt-2",children:"Sincronizando com o banco de dados"})]}),e.jsx("style",{children:`
          @keyframes gradientShift {
            0%   { background-position: 0% 50%; }
            25%  { background-position: 25% 50%; }
            50%  { background-position: 50% 50%; }
            75%  { background-position: 75% 50%; }
            100% { background-position: 100% 50%; }
          }
        `})]}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden gradient-animated",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-10 left-10 w-12 h-12 md:w-20 md:h-20 bg-yellow-300/20 rounded-full animate-bounce",style:{animationDelay:"0s",animationDuration:"3s"}}),e.jsx("div",{className:"absolute top-32 right-20 w-10 h-10 md:w-16 md:h-16 bg-pink-300/20 rounded-full animate-bounce",style:{animationDelay:"1s",animationDuration:"4s"}}),e.jsx("div",{className:"absolute bottom-20 left-32 w-16 h-16 md:w-24 md:h-24 bg-blue-300/20 rounded-full animate-bounce",style:{animationDelay:"2s",animationDuration:"5s"}}),e.jsx("div",{className:"absolute bottom-40 right-10 w-8 h-8 md:w-12 md:h-12 bg-green-300/20 rounded-full animate-bounce",style:{animationDelay:"0.5s",animationDuration:"3.5s"}}),e.jsx("div",{className:"absolute top-1/2 left-20 w-6 h-6 md:w-8 md:h-8 bg-purple-300/20 rounded-full animate-bounce",style:{animationDelay:"1.5s",animationDuration:"4.5s"}}),e.jsx("div",{className:"absolute top-1/3 right-1/4 w-10 h-10 md:w-14 md:h-14 bg-orange-300/20 rounded-full animate-bounce",style:{animationDelay:"2.5s",animationDuration:"3.8s"}}),e.jsx("div",{className:"absolute top-20 left-1/4 text-yellow-300/70 text-xl md:text-2xl animate-pulse",style:{animationDuration:"2s"},children:"⭐"}),e.jsx("div",{className:"absolute top-40 right-1/3 text-yellow-300/70 text-lg md:text-xl animate-pulse",style:{animationDuration:"3s"},children:"✨"}),e.jsx("div",{className:"absolute bottom-60 left-1/2 text-yellow-300/70 text-2xl md:text-3xl animate-pulse",style:{animationDuration:"2.5s"},children:"🌟"}),e.jsx("div",{className:"absolute top-60 left-20 text-yellow-300/70 text-base md:text-lg animate-pulse",style:{animationDuration:"4s"},children:"💫"}),e.jsx("div",{className:"absolute bottom-32 right-1/3 text-yellow-300/70 text-xl md:text-2xl animate-pulse",style:{animationDuration:"3.5s"},children:"⭐"}),e.jsx("div",{className:"absolute top-1/2 right-10 text-yellow-300/70 text-lg md:text-xl animate-pulse",style:{animationDuration:"2.8s"},children:"✨"})]}),e.jsx(I,{user:a,daysRemaining:f,onLogout:C,onRenew:F}),e.jsxs("main",{className:"container mx-auto px-2 md:px-4 py-4 md:py-8 relative z-10 main-content",children:[e.jsxs("section",{className:"mb-6 md:mb-8",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white mb-4 drop-shadow-lg text-center md:text-left",style:{fontFamily:"Pacifico, serif"},children:"Histórias Bíblicas! 📖"}),e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-xl p-4 md:p-6 shadow-xl border-2 border-purple-200/50",children:[e.jsxs("div",{className:"hidden md:flex items-center space-x-4",children:[e.jsx("div",{className:"w-3/4",children:e.jsx(y,{progress:N,total:i.length})}),e.jsxs("div",{className:"w-1/4 relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar história...",value:u,onChange:t=>b(t.target.value),className:"w-full pl-10 pr-4 py-2 border-2 border-purple-300/50 rounded-xl focus:border-purple-500 focus:outline-none transition-all duration-300 text-sm bg-white/90 backdrop-blur-sm shadow-lg hover:shadow-xl"}),e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-purple-500 text-sm"})]})]}),e.jsxs("div",{className:"md:hidden space-y-4",children:[e.jsx(y,{progress:N,total:i.length}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Buscar história...",value:u,onChange:t=>b(t.target.value),className:"w-full pl-10 pr-4 py-2 border-2 border-purple-300/50 rounded-xl focus:border-purple-500 focus:outline-none transition-all duration-300 text-sm bg-white/90 backdrop-blur-sm shadow-lg hover:shadow-xl"}),e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-purple-500 text-sm"})]})]})]})]}),e.jsx("section",{className:"mb-6",children:e.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-xl p-4 shadow-xl border-2 border-purple-200/50",children:e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:justify-center md:space-y-0 md:space-x-2 md:flex-wrap",children:[e.jsxs("button",{onClick:()=>c("all"),className:`px-3 py-2 rounded-lg font-medium transition-all duration-300 whitespace-nowrap text-sm ${n==="all"?"bg-purple-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("i",{className:"ri-list-check mr-1"})," TODOS"]}),e.jsxs("button",{onClick:()=>c("read"),className:`px-3 py-2 rounded-lg font-medium transition-all duration-300 whitespace-nowrap text-sm ${n==="read"?"bg-green-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("i",{className:"ri-book-read-line mr-1"})," LIDOS"]}),e.jsxs("button",{onClick:()=>c("unread"),className:`px-3 py-2 rounded-lg font-medium transition-all duration-300 whitespace-nowrap text-sm ${n==="unread"?"bg-red-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("i",{className:"ri-book-open-line mr-1"})," NÃO LIDOS"]}),e.jsxs("button",{onClick:()=>c("new"),className:`px-3 py-2 rounded-lg font-medium transition-all duration-300 whitespace-nowrap text-sm ${n==="new"?"bg-orange-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("i",{className:"ri-star-line mr-1"})," NOVIDADES"]}),e.jsxs("button",{onClick:()=>c("favorites"),className:`px-3 py-2 rounded-lg font-medium transition-all duration-300 whitespace-nowrap text-sm ${n==="favorites"?"bg-pink-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("i",{className:"ri-heart-line mr-1"})," FAVORITOS"]}),e.jsxs("button",{onClick:()=>c("old_testament"),className:`px-3 py-2 rounded-lg font-medium transition-all duration-300 whitespace-nowrap text-sm ${n==="old_testament"?"bg-blue-500 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("i",{className:"ri-book-2-line mr-1"})," ANTIGO TESTAMENTO"]}),e.jsxs("button",{onClick:()=>c("new_testament"),className:`px-3 py-2 rounded-lg font-medium transition-all duration-300 whitespace-nowrap text-sm ${n==="new_testament"?"bg-indigo-5 00 text-white shadow-lg":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:[e.jsx("i",{className:"ri-book-open-line mr-1"})," NOVO TESTAMENTO"]})]})})}),e.jsx("section",{children:i.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-xl p-8 shadow-xl border-2 border-purple-200/50 max-w-md mx-auto",children:[e.jsx("i",{className:"ri-book-line text-6xl text-purple-500 mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",style:{fontFamily:"Pacifico, serif"},children:"Nenhuma História Cadastrada"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"O administrador ainda não adicionou histórias ao sistema. Entre em contato para mais informações."}),e.jsxs("button",{onClick:()=>window.open("https://wa.me/5511999999999?text=Olá! Não há histórias cadastradas no sistema","_blank"),className:"bg-green-500 hover:bg-green-600 text-white font-bold px-6 py-3 rounded-lg transition-all duration-300 whitespace-nowrap",children:[e.jsx("i",{className:"ri-whatsapp-line mr-2"}),"Falar com Suporte"]})]})}):e.jsxs(e.Fragment,{children:[m.filter(t=>!t.testament||t.testament!=="old"&&t.testament!=="new").length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h3",{className:"text-3xl md:text-4xl font-bold text-white mb-4 text-center drop-shadow-lg",style:{fontFamily:"Pacifico, serif"},children:"📖 Histórias Bíblicas!"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8",children:m.filter(t=>!t.testament||t.testament!=="old"&&t.testament!=="new").map(t=>{var s,r;return e.jsx(j,{story:{...t,order_number:t.order_number||0},isCompleted:((s=a==null?void 0:a.stories_progress)==null?void 0:s[t.id])??!1,onRead:()=>w(t.id),isFavorite:((r=a==null?void 0:a.favorite_stories)==null?void 0:r.includes(t.id))??!1,onToggleFavorite:()=>v(t.id)},t.id)})})]}),m.filter(t=>t.testament==="old").length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h3",{className:"text-3xl md:text-4xl font-bold text-white mb-4 text-center drop-shadow-lg",style:{fontFamily:"Pacifico, serif"},children:"📜 Antigo Testamento"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8",children:m.filter(t=>t.testament==="old").map(t=>{var s,r;return e.jsx(j,{story:{...t,order_number:t.order_number||0},isCompleted:((s=a==null?void 0:a.stories_progress)==null?void 0:s[t.id])??!1,onRead:()=>w(t.id),isFavorite:((r=a==null?void 0:a.favorite_stories)==null?void 0:r.includes(t.id))??!1,onToggleFavorite:()=>v(t.id)},t.id)})})]}),m.filter(t=>t.testament==="new").length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h3",{className:"text-3xl md:text-4xl font-bold text-white mb-4 text-center drop-shadow-lg",style:{fontFamily:"Pacifico, serif"},children:"✨ Novo Testamento"})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:m.filter(t=>t.testament==="new").map(t=>{var s,r;return e.jsx(j,{story:{...t,order_number:t.order_number||0},isCompleted:((s=a==null?void 0:a.stories_progress)==null?void 0:s[t.id])??!1,onRead:()=>w(t.id),isFavorite:((r=a==null?void 0:a.favorite_stories)==null?void 0:r.includes(t.id))??!1,onToggleFavorite:()=>v(t.id)},t.id)})})]}),m.length===0&&i.length>0&&e.jsx("div",{className:"text-center py-16",children:e.jsxs("div",{className:"bg-white/90 backdrop-blur-sm rounded-xl p-8 shadow-xl border-2 border-purple-200/50 max-w-md mx-auto",children:[e.jsx("i",{className:"ri-search-line text-6xl text-purple-500 mb-4"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800 mb-4",style:{fontFamily:"Pacifico, serif"},children:"Nenhuma História Encontrada"}),e.jsx("p",{className:"text-gray-600",children:"Nenhuma história encontrada para o filter selecionado. Tente alterar os filtros ou busca."})]})})]})})]}),e.jsx("footer",{className:"relative z-10 p-4 text-center",children:e.jsxs("p",{className:"text-white/80 text-sm",children:["© ",new Date().getFullYear()," Profeta de Deus Kids - Desenvolvido com ❤️ para as crianças"]})}),e.jsx("style",{children:`
        @keyframes gradientShift {
          0%   { background-position: 0% 50%; }
          25%  { background-position: 25% 50%; }
          50%  { background-position: 50% 50%; }
          75%  { background-position: 75% 50%; }
          100% { background-position: 100% 50%; }
        }
      `})]}):null}export{B as default};
