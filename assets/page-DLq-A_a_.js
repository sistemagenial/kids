import{r as o,j as e,c as C,u as z,a as P}from"./index-DkWMjuHb.js";import{H as E}from"./Header-DPb4Nwfq.js";import{B as H}from"./Button-B4k9wJs-.js";import{W as B}from"./WhatsAppButton-B-vl6nZy.js";import{getAllStories as D,getStoryById as I,updateUser as A}from"./database-DuIwEKn7.js";const T=[{label:"Pequeno",value:14},{label:"Normal",value:16},{label:"Grande",value:18},{label:"Muito Grande",value:20}];function F(){const[l,t]=o.useState(!1),[y,c]=o.useState({fontSize:16}),x=o.useRef(null);o.useEffect(()=>{const s=localStorage.getItem("reading_enhancer_settings");if(s)try{const r={fontSize:JSON.parse(s).fontSize||16};c(r),i(r)}catch(a){console.error("Erro ao carregar configurações:",a)}},[]),o.useEffect(()=>{const s=a=>{x.current&&!x.current.contains(a.target)&&t(!1)};return l&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[l]);const i=s=>{const a=[".story-content",".story-text",".content-text",".story-content p",".story-text p",".content-text p",".prose",".prose p",".text-gray-700",'div[style*="line-height"]',".whitespace-pre-wrap"];a.forEach(r=>{document.querySelectorAll(r).forEach(n=>{n&&(n.style.fontSize=`${s.fontSize}px`,n.style.lineHeight="1.8")})}),setTimeout(()=>{a.forEach(r=>{document.querySelectorAll(r).forEach(n=>{n&&(n.style.fontSize=`${s.fontSize}px`,n.style.lineHeight="1.8")})})},100)},j=s=>{c(s),localStorage.setItem("reading_enhancer_settings",JSON.stringify(s)),i(s)},N=s=>{const a={fontSize:s};j(a),setTimeout(()=>{i(a)},50)},S=()=>{t(!l)};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:S,className:"fixed bottom-6 left-6 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white px-4 py-3 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 z-50 hover:scale-110 font-bold text-sm whitespace-nowrap",children:"LEITURA+"}),l&&e.jsx("div",{className:"fixed bottom-20 left-6 z-50",children:e.jsxs("div",{ref:x,className:"bg-white rounded-xl p-4 w-64 shadow-2xl border-2 border-purple-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center",children:[e.jsx("i",{className:"ri-font-size-2 mr-2 text-blue-600"}),"Tamanho da Fonte"]}),e.jsx("button",{onClick:()=>t(!1),className:"text-gray-500 hover:text-gray-700 text-xl",children:e.jsx("i",{className:"ri-close-line"})})]}),e.jsx("div",{className:"space-y-3",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:T.map(s=>e.jsx("button",{onClick:()=>N(s.value),className:`p-3 rounded-lg border-2 transition-all duration-300 text-sm font-medium hover:scale-105 cursor-pointer ${y.fontSize===s.value?"border-blue-500 bg-blue-50 text-blue-700 shadow-md transform scale-105":"border-gray-200 hover:border-blue-300 text-gray-700 hover:bg-blue-50"}`,children:s.label},s.value))})})]})})]})}function J(){const{id:l}=C(),[t,y]=o.useState(null),[c,x]=o.useState([]),[i,j]=o.useState(null),[N,S]=o.useState(!0),[s,a]=o.useState(!1),r=z(),v=P();o.useEffect(()=>{(async()=>{var w;try{const d=localStorage.getItem("user");if(!d){r("/login");return}const h=JSON.parse(d);j(h);const{data:g}=await D();if(g){const p=g.sort((b,_)=>b.order_number-_.order_number);x(p),console.log("📚 Histórias carregadas e ordenadas:",p.map(b=>({id:b.id,title:b.title,order:b.order_number})))}if(l){const{data:p}=await I(l);p&&(y(p),a(((w=h.stories_progress)==null?void 0:w[l])||!1))}}catch(d){console.error("Erro ao carregar história:",d)}finally{S(!1)}})()},[l,r]),o.useEffect(()=>{if(i&&t&&!s){const w=setTimeout(async()=>{try{const h={...i.stories_progress||{},[t.id]:!0},g={...i,stories_progress:h};j(g),a(!0),localStorage.setItem("user",JSON.stringify(g)),await A(i.id,{stories_progress:h}),v.success("História marcada como lida","")}catch(d){console.error("Erro ao marcar história como lida:",d)}},5e3);return()=>clearTimeout(w)}},[i,t,s,v]);const n=()=>{localStorage.removeItem("user"),r("/login")},f=c.findIndex(k=>String(k.id)===String(t==null?void 0:t.id)),m=f>0?c[f-1]:null,u=f<c.length-1?c[f+1]:null;return console.log("🔍 Navegação:",{currentIndex:f,currentStory:t==null?void 0:t.title,previousStory:m==null?void 0:m.title,nextStory:u==null?void 0:u.title,totalStories:c.length}),N?e.jsxs("div",{className:"min-h-screen flex items-center justify-center",style:{background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 25%, #10b981 50%, #ec4899 75%, #3b82f6 100%)",backgroundSize:"400% 400%",animation:"gradientShift 25s ease infinite"},children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-white drop-shadow-lg",style:{fontFamily:"Pacifico, serif"},children:"Carregando história..."})]}),e.jsx("style",{children:`
          @keyframes gradientShift {
            0%   { background-position: 0% 50%; }
            25%  { background-position: 25% 50%; }
            50%  { background-position: 50% 50%; }
            75%  { background-position: 75% 50%; }
            100% { background-position: 100% 50%; }
          }
        `})]}):t?e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 25%, #10b981 50%, #ec4899 75%, #3b82f6 100%)",backgroundSize:"400% 400%",animation:"gradientShift 25s ease infinite"},children:[e.jsx(E,{user:i,onLogout:n,showBackButton:!0,onBack:()=>r("/historias")}),e.jsx("main",{className:"container mx-auto px-4 py-8 max-w-4xl relative z-10",children:e.jsxs("div",{className:"bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl border border-white/30 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white p-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>r("/historias"),className:"p-2 hover:bg-white/20 rounded-full transition-colors",children:e.jsx("i",{className:"ri-arrow-left-line text-2xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-4 text-purple-100",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-book-line mr-1"}),"História #",t.order_number]}),t.testament&&e.jsxs("span",{className:"flex items-center",children:[e.jsx("i",{className:"ri-bookmark-line mr-1"}),t.testament==="old"?"Antigo Testamento":"Novo Testamento"]}),t.is_new&&e.jsx("span",{className:"bg-orange-500 text-white px-2 py-1 rounded-full text-xs font-bold",children:"NOVIDADE"})]})]})]})})}),t.image_url&&e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-auto object-contain"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/10 to-transparent"})]}),e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsx("div",{className:"prose prose-lg max-w-none",children:e.jsx("div",{className:"text-gray-700 leading-relaxed text-lg whitespace-pre-wrap",style:{lineHeight:"1.8"},children:t.content})}),t.pdf_url&&e.jsx("div",{className:"mt-8 p-4 bg-blue-50 rounded-xl border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ri-file-pdf-line text-2xl text-red-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Versão em PDF"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Baixe esta história + desenho para pintar em PDF"})]})]}),e.jsxs("a",{href:t.pdf_url,target:"_blank",rel:"noopener noreferrer",className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-bold px-6 py-3 rounded-lg transition-all duration-300 whitespace-nowrap",children:[e.jsx("i",{className:"ri-download-line mr-2"}),"Baixar PDF"]})]})}),e.jsxs("div",{className:"mt-8 flex flex-col md:flex-row justify-between items-center gap-4",children:[m?e.jsxs("button",{onClick:()=>r(`/story/${m.id}`),className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold px-6 py-3 rounded-lg transition-all duration-300 whitespace-nowrap w-full md:w-auto flex items-center justify-center",title:`Anterior: ${m.title}`,children:[e.jsx("i",{className:"ri-arrow-left-s-line mr-2"}),"História Anterior"]}):e.jsx("div",{className:"w-full md:w-auto"}),e.jsxs("button",{onClick:()=>r("/historias"),className:"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold px-6 py-3 rounded-lg transition-all duration-300 whitespace-nowrap w-full md:w-auto flex items-center justify-center",children:[e.jsx("i",{className:"ri-book-line mr-2"}),"Todas as Histórias"]}),u?e.jsxs("button",{onClick:()=>r(`/story/${u.id}`),className:"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold px-6 py-3 rounded-lg transition-all duration-300 whitespace-nowrap w-full md:w-auto flex items-center justify-center",title:`Próxima: ${u.title}`,children:["Próxima História",e.jsx("i",{className:"ri-arrow-right-s-line ml-2"})]}):e.jsx("div",{className:"w-full md:w-auto"})]})]})]})}),e.jsx(F,{}),e.jsx(B,{message:`Olá! Estou lendo a história: ${t.title}`}),e.jsx("footer",{className:"relative z-10 p-4 text-center",children:e.jsxs("p",{className:"text-white/80 text-sm",children:["© ",new Date().getFullYear()," Profeta de Deus Kids - Desenvolvido com ❤️ para as crianças"]})}),e.jsx("style",{children:`
        @keyframes gradientShift {
          0%   { background-position: 0% 50%; }
          25%  { background-position: 25% 50%; }
          50%  { background-position: 50% 50%; }
          75%  { background-position: 75% 50%; }
          100% { background-position: 100% 50%; }
        }
      `})]}):e.jsxs("div",{className:"min-h-screen",style:{background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 25%, #10b981 50%, #ec4899 75%, #3b82f6 100%)",backgroundSize:"400% 400%",animation:"gradientShift 25s ease infinite"},children:[e.jsx(E,{user:i,onLogout:n,showBackButton:!0,onBack:()=>r("/historias")}),e.jsxs("div",{className:"container mx-auto px-4 py-8 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-4",style:{fontFamily:"Pacifico, serif"},children:"História não encontrada"}),e.jsx(H,{onClick:()=>r("/historias"),className:"bg-purple-500 hover:bg-purple-600 text-white",children:"Voltar para Histórias"})]}),e.jsx("style",{children:`
          @keyframes gradientShift {
            0%   { background-position: 0% 50%; }
            25%  { background-position: 25% 50%; }
            50%  { background-position: 50% 50%; }
            75%  { background-position: 75% 50%; }
            100% { background-position: 100% 50%; }
          }
        `})]})}export{J as default};
