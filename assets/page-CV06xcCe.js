import{u as F,a as L,r as n,j as e}from"./index-DkWMjuHb.js";import{H as T}from"./Header-DPb4Nwfq.js";import{C as u}from"./Card-CpNQlLbP.js";import{B as d}from"./Button-B4k9wJs-.js";import{generateDeviceId as U,getUserDevices as B,removeDevice as O,updateDeviceName as q}from"./database-DuIwEKn7.js";function K(){const c=F(),{success:j,error:l}=L(),[t,D]=n.useState(null),[p,E]=n.useState([]),[C,N]=n.useState(!0),[y,S]=n.useState(""),[w,h]=n.useState(null),[g,m]=n.useState("");n.useEffect(()=>{const s=localStorage.getItem("user");if(!s){c("/login");return}try{const r=JSON.parse(s);D(r);const a=U();S(a),v(r.id)}catch(r){console.error("Erro ao carregar dados do usu√°rio:",r),c("/login")}},[c]);const v=async s=>{try{N(!0);const{data:r,error:a}=await B(s);if(a){l("Erro","N√£o foi poss√≠vel carregar os dispositivos");return}const i=(r==null?void 0:r.reduce((o,x)=>{const f=o.findIndex(b=>b.device_id===x.device_id);if(f===-1)o.push(x);else{const b=o[f];new Date(x.last_access)>new Date(b.last_access)&&(o[f]=x)}return o},[]))||[];console.log("üì± Dispositivos √∫nicos carregados:",i.length),E(i)}catch(r){console.error("Erro ao carregar dispositivos:",r),l("Erro","Falha ao carregar dispositivos")}finally{N(!1)}},_=async(s,r)=>{if(window.confirm(`Tem certeza que deseja remover o dispositivo "${r}"?

Esta a√ß√£o ir√° desconectar o dispositivo imediatamente.`))try{const{error:a}=await O(t.id,s);if(a){l("Erro","N√£o foi poss√≠vel remover o dispositivo");return}if(j("Sucesso","Dispositivo removido com sucesso"),s===y){setTimeout(()=>{localStorage.clear(),c("/login")},1e3);return}v(t.id)}catch(a){console.error("Erro ao remover dispositivo:",a),l("Erro","Falha ao remover dispositivo")}},I=async s=>{if(!g.trim()){l("Erro","Nome do dispositivo n√£o pode estar vazio");return}try{await q(t.id,s,g.trim()),j("Sucesso","Nome do dispositivo atualizado"),h(null),m(""),v(t.id)}catch(r){console.error("Erro ao atualizar nome do dispositivo:",r),l("Erro","Falha ao atualizar nome do dispositivo")}},k=s=>{h(s.device_id),m(s.name)},R=()=>{h(null),m("")},P=s=>{switch(s.toLowerCase()){case"android":return"ri-android-line";case"ios":return"ri-apple-line";case"windows":return"ri-windows-line";case"mac":return"ri-apple-line";case"linux":return"ri-ubuntu-line";default:return"ri-computer-line"}},z=s=>{const r=new Date(s),i=Math.floor((new Date().getTime()-r.getTime())/(1e3*60));if(i<1)return"Agora mesmo";if(i<60)return`${i} min atr√°s`;if(i<1440)return`${Math.floor(i/60)}h atr√°s`;const o=Math.floor(i/1440);return`${o} dia${o>1?"s":""} atr√°s`},M=s=>{switch(s){case 1:return"B√ÅSICO";case 3:return"PRO";case 5:return"PREMIUM";default:return"B√ÅSICO"}},$=()=>{localStorage.clear(),c("/login")};return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando dispositivos..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50",children:[e.jsx(T,{user:t,onLogout:$}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Gerenciar Dispositivos"}),e.jsx("p",{className:"text-gray-600",children:"Gerencie os dispositivos conectados √† sua conta"})]}),e.jsx(u,{className:"mb-8 p-6 bg-white/80 backdrop-blur-sm border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Plano ",M(t.license_count)]}),e.jsxs("p",{className:"text-gray-600",children:["Voc√™ pode usar at√© ",t.license_count," dispositivo",t.license_count>1?"s":""," simultaneamente"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[p.length," / ",t.license_count]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Dispositivos √∫nicos"})]})]})}),e.jsx("div",{className:"space-y-4",children:p.length===0?e.jsxs(u,{className:"p-8 text-center bg-white/80 backdrop-blur-sm border border-white/20",children:[e.jsx("i",{className:"ri-smartphone-line text-4xl text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Nenhum dispositivo conectado"}),e.jsx("p",{className:"text-gray-600",children:"Fa√ßa login em um dispositivo para v√™-lo aparecer aqui"})]}):p.map(s=>e.jsx(u,{className:"p-6 bg-white/80 backdrop-blur-sm border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:`${P(s.type)} text-2xl text-blue-600`})}),e.jsx("div",{className:"flex-1",children:w===s.device_id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:g,onChange:r=>m(r.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nome do dispositivo"}),e.jsxs(d,{onClick:()=>I(s.device_id),className:"bg-green-500 hover:bg-green-600 text-white px-3 py-2",children:[e.jsx("i",{className:"ri-check-line mr-1"}),"Salvar"]}),e.jsxs(d,{onClick:R,className:"bg-gray-500 hover:bg-gray-600 text-white px-3 py-2",children:[e.jsx("i",{className:"ri-close-line mr-1"}),"Cancelar"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:s.name}),s.device_id===y&&e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-medium",children:"Este dispositivo"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.type," ‚Ä¢ IP: ",s.ip]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["√öltimo acesso: ",z(s.last_access)]})]})})]}),w!==s.device_id&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(d,{onClick:()=>k(s),className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-2",title:"Renomear dispositivo",children:[e.jsx("i",{className:"ri-edit-line mr-1"}),"Renomear"]}),e.jsxs(d,{onClick:()=>_(s.device_id,s.name),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-2",title:"Remover dispositivo",children:[e.jsx("i",{className:"ri-delete-bin-line mr-1"}),"Remover"]})]})]})},s.id))}),e.jsxs(u,{className:"mt-8 p-6 bg-blue-50/80 backdrop-blur-sm border border-blue-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-800 mb-3",children:[e.jsx("i",{className:"ri-information-line mr-2"}),"Informa√ß√µes importantes"]}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[e.jsx("p",{children:"‚Ä¢ Cada dispositivo f√≠sico aparece apenas uma vez na lista"}),e.jsx("p",{children:"‚Ä¢ Voc√™ pode renomear seus dispositivos para identific√°-los melhor"}),e.jsx("p",{children:"‚Ä¢ Ao remover um dispositivo, ele ser√° desconectado imediatamente"}),e.jsx("p",{children:"‚Ä¢ Se voc√™ remover o dispositivo atual, ser√° deslogado automaticamente"}),e.jsx("p",{children:"‚Ä¢ Para usar mais dispositivos simultaneamente, fa√ßa upgrade do seu plano"})]})]}),e.jsx("div",{className:"text-center mt-8",children:e.jsxs(d,{onClick:()=>c("/inicio"),className:"bg-gray-500 hover:bg-gray-600 text-white font-bold px-6 py-3",children:[e.jsx("i",{className:"ri-arrow-left-line mr-2"}),"Voltar ao In√≠cio"]})})]})]})}export{K as default};
