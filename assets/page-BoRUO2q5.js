import{r as n,u as Y,a as Z,j as e,_ as B}from"./index-DkWMjuHb.js";import{loginUser as ee,getUserDevices as te,registerDevice as se}from"./database-DuIwEKn7.js";import{B as h}from"./Button-B4k9wJs-.js";import{I as z}from"./Input-DWPq2EuO.js";import{C as U}from"./Card-CpNQlLbP.js";import{W as re}from"./WhatsAppButton-B-vl6nZy.js";function de(){const[p,P]=n.useState(""),[N,C]=n.useState(""),[d,$]=n.useState(!0),[E,g]=n.useState(!1),[j,O]=n.useState(!1),[k,T]=n.useState(!1),[y,W]=n.useState(!1),[F,D]=n.useState(!1),[S,A]=n.useState([]),[a,J]=n.useState(null),[_,V]=n.useState(!1),u=Y(),c=Z();n.useEffect(()=>{const t=()=>{const r=navigator.userAgent.toLowerCase(),s=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/.test(r)||window.innerWidth<=768;W(s)};return t(),window.addEventListener("resize",t),q(),y&&L(),()=>window.removeEventListener("resize",t)},[]),n.useEffect(()=>{y&&L()},[y]);const q=async()=>{try{const t=localStorage.getItem("trusted_ip"),r=I(),s=await x();if(t&&t===s){const l=localStorage.getItem("user"),m=localStorage.getItem("registered_devices");if(l&&m&&JSON.parse(m).some(f=>f.id===r)){u("/inicio");return}}const i=localStorage.getItem("remembered_email"),b=localStorage.getItem("remembered_password");i&&b&&(P(i),C(b),O(!0))}catch(t){console.error("Erro no auto-login:",t),localStorage.removeItem("user"),localStorage.removeItem("trusted_ip"),localStorage.removeItem("registered_devices")}},x=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch(t){return console.error("Erro ao obter IP:",t),null}},I=()=>{let t=localStorage.getItem("device_id");return t||(t="device_"+Math.random().toString(36).substr(2,9)+"_"+Date.now(),localStorage.setItem("device_id",t)),t},R=()=>{const t=navigator.userAgent;let r="Desktop",s="Computador";return/android/i.test(t)?(r="Android",s="Dispositivo Android"):/iPad|iPhone|iPod/.test(t)?(r="iOS",s=/iPad/.test(t)?"iPad":"iPhone"):/Windows/.test(t)?(r="Windows",s="PC Windows"):/Mac/.test(t)?(r="Mac",s="Mac"):/Linux/.test(t)&&(r="Linux",s="PC Linux"),{type:r,name:s}},L=()=>{"credentials"in navigator&&"create"in navigator.credentials&&T(!0)},M=t=>t.replace(/\D+/g,"").slice(0,11),K=async t=>{t.preventDefault(),g(!0);try{if(d){if(!p||!N){c.error("Campos obrigat√≥rios","Por favor, preencha todos os campos"),g(!1);return}const r=M(N);console.log("üîç Tentando login com:",{email:p,password:r.substring(0,3)+"***"});const{data:s,error:i}=await ee(p,r);if(i){console.log("‚ùå Erro no login:",i),c.error("Erro no login",i),g(!1);return}if(!s){console.log("‚ùå Usu√°rio n√£o retornado pela API"),c.error("Usu√°rio n√£o encontrado","Verifique suas credenciais ou cadastre-se"),g(!1);return}console.log("‚úÖ Login bem-sucedido:",s.name);const{data:b}=await te(s.id),l=I(),m=b||[],v=m.some(o=>o.device_id===l&&o.is_active);if(v){localStorage.setItem("user",JSON.stringify(s)),j?(localStorage.setItem("remembered_email",p),localStorage.setItem("remembered_password",r),k&&y&&localStorage.setItem("biometric_user",JSON.stringify(s))):(localStorage.removeItem("remembered_email"),localStorage.removeItem("remembered_password"));const o=await x();o&&localStorage.setItem("trusted_ip",o),u("/inicio");return}const w=s.is_admin?99:s.license_count;if(!v&&m.length>=w){J(s),A(m.map(o=>({id:o.device_id,name:o.name,type:o.type,lastAccess:o.last_access,ip:o.ip}))),D(!0),g(!1);return}if(!v){const o=R();await se({user_id:s.id,device_id:l,name:o.name,type:o.type,last_access:new Date().toISOString(),ip:await x()??"Desconhecido",is_active:!0})}localStorage.setItem("user",JSON.stringify(s)),j?(localStorage.setItem("remembered_email",p),localStorage.setItem("remembered_password",r),k&&y&&localStorage.setItem("biometric_user",JSON.stringify(s))):(localStorage.removeItem("remembered_email"),localStorage.removeItem("remembered_password"));const f=await x();f&&localStorage.setItem("trusted_ip",f),c.success("Login realizado!",`Bem-vindo, ${s.name}!`),u("/inicio")}else u("/comprar-licenca")}catch(r){console.error("Erro no login/cadastro:",r),c.error("Erro no sistema","Tente novamente em alguns instantes")}finally{g(!1)}},G=async t=>{if(a)try{const{removeDevice:r}=await B(async()=>{const{removeDevice:l}=await import("./database-DuIwEKn7.js");return{removeDevice:l}},[]),{error:s}=await r(a.id,t);if(s){c.error("Erro","N√£o foi poss√≠vel remover o dispositivo");return}const i=S.filter(l=>l.id!==t);A(i),c.success("Dispositivo removido","Sess√£o encerrada com sucesso");const b=a.is_admin?99:a.license_count;if(i.length<b){const l=R(),m=I(),{registerDevice:v}=await B(async()=>{const{registerDevice:f}=await import("./database-DuIwEKn7.js");return{registerDevice:f}},[]);await v({user_id:a.id,device_id:m,name:l.name,type:l.type,last_access:new Date().toISOString(),ip:await x()??"Desconhecido",is_active:!0}),localStorage.setItem("user",JSON.stringify(a));const w=await x();w&&localStorage.setItem("trusted_ip",w),c.success("Login realizado!",`Bem-vindo, ${a.name}!`),D(!1),u("/inicio")}}catch(r){console.error("Erro ao remover dispositivo:",r),c.error("Erro","N√£o foi poss√≠vel remover o dispositivo")}},H=()=>{if(!a)return;const t=a.license_count===1?"B√°sico":a.license_count===3?"PRO":a.license_count===5?"Premium":"Personalizado",r=`Ol√°! Gostaria de fazer upgrade do meu plano.

üìã *DADOS DO CADASTRO:*
‚Ä¢ Nome: ${a.name}
‚Ä¢ Email: ${a.email}
‚Ä¢ Plano Atual: ${t} (${a.license_count} dispositivos)

üöÄ *SOLICITA√á√ÉO:*
Gostaria de fazer upgrade para o Plano Premium (5 dispositivos) - RECOMENDADO!

Por favor, me informe as op√ß√µes dispon√≠veis e valores.`,i=`https://wa.me/5511999999999?text=${encodeURIComponent(r)}`;window.open(i,"_blank"),c.info("Redirecionando...","Voc√™ ser√° direcionado para o WhatsApp")},Q=t=>{switch(t){case"Android":return"ri-android-line";case"iOS":return"ri-apple-line";case"Windows":return"ri-windows-line";case"Mac":return"ri-apple-line";case"Linux":return"ri-ubuntu-line";default:return"ri-computer-line"}},X=()=>a?a.license_count===1?[{name:"Premium",devices:5,description:"B√°sico ‚Üí Premium (1 ‚Üí 5 dispositivos) - RECOMENDADO",recommended:!0},{name:"PRO",devices:3,description:"B√°sico ‚Üí PRO (1 ‚Üí 3 dispositivos)",recommended:!1}]:a.license_count===3?[{name:"Premium",devices:5,description:"PRO ‚Üí Premium (3 ‚Üí 5 dispositivos) - RECOMENDADO",recommended:!0}]:[]:[];if(F&&a){const t=X(),r=a.is_admin?99:a.license_count;return e.jsx("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden",style:{background:"linear-gradient(135deg, #3b82f6 0%, #f97316 20%, #ef4444 40%, #8b5cf6 60%, #ec4899 80%, #3b82f6 100%)",backgroundSize:"400% 400%",animation:"gradientShift 25s ease infinite"},children:e.jsx("div",{className:"w-full max-w-2xl mx-4 relative z-10",children:e.jsxs(U,{className:"bg-white/95 backdrop-blur-sm border-2 border-red-200/50 shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("i",{className:"ri-error-warning-line text-6xl text-red-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-red-700 mb-2",children:"Limite de Dispositivos Atingido"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Voc√™ j√° tem ",S.length," dispositivo(s) registrado(s) de"," ",r," permitido(s). Para acessar neste dispositivo, remova um dos dispositivos abaixo",t.length>0?" ou fa√ßa upgrade do seu plano":"",":"]}),t.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border-2 border-blue-200",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-700 mb-3",children:"üöÄ Op√ß√µes de Upgrade Dispon√≠veis"}),e.jsx("div",{className:"space-y-2",children:t.map((s,i)=>e.jsxs(h,{onClick:H,className:`w-full font-bold px-4 py-3 whitespace-nowrap ${s.recommended?"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white":"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white"}`,children:[e.jsx("i",{className:"ri-vip-crown-line mr-2"}),s.description]},i))})]}),a.license_count===5&&!a.is_admin&&e.jsxs("div",{className:"mb-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border-2 border-green-200",children:[e.jsx("h3",{className:"text-lg font-bold text-green-700 mb-2",children:"üèÜ Plano Premium Ativo"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Voc√™ j√° possui o plano Premium com limite m√°ximo de 5 dispositivos simult√¢neos."})]})]}),e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg border",children:e.jsxs("p",{className:"text-sm text-gray-700 text-center",children:[e.jsx("i",{className:"ri-information-line mr-2 text-blue-500"}),"Abaixo est√£o todos os dispositivos logados usando seu cadastro. Caso queira desconectar algum para liberar acessos, clique em ",e.jsx("strong",{children:"ENCERRAR SESS√ÉO"}),"."]})}),e.jsx("div",{className:"space-y-4 mb-6",children:S.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:`${Q(s.type)} text-2xl text-gray-600`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.type," ‚Ä¢ IP: ",s.ip]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["√öltimo acesso: ",new Date(s.lastAccess).toLocaleString("pt-BR")]})]})]}),e.jsxs(h,{onClick:()=>G(s.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 text-sm whitespace-nowrap",children:[e.jsx("i",{className:"ri-delete-bin-line mr-1"}),"Encerrar Sess√£o"]})]},s.id))}),e.jsxs("div",{className:"text-center",children:[e.jsx(h,{onClick:()=>D(!1),variant:"secondary",className:"mr-4 whitespace-nowrap",children:"Cancelar"}),t.length>0&&e.jsx("p",{className:"text-sm text-gray-600 mt-4",children:"Precisa de mais dispositivos? Entre em contato via WhatsApp!"})]})]})})})}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center relative overflow-hidden py-8 pb-32",style:{background:"linear-gradient(135deg, #ff6b9d 0%, #c44569 25%, #f8b500 50%, #40407a 75%, #706fd3 100%)",backgroundSize:"400% 400%",animation:"gradientShift 25s ease infinite"},children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-20 left-20 w-16 h-16 bg-yellow-300/30 rounded-full animate-bounce",style:{animationDelay:"0s",animationDuration:"3s"}}),e.jsx("div",{className:"absolute top-40 right-32 w-12 h-12 bg-pink-300/30 rounded-full animate-bounce",style:{animationDelay:"1s",animationDuration:"4s"}}),e.jsx("div",{className:"absolute bottom-32 left-40 w-20 h-20 bg-blue-300/30 rounded-full animate-bounce",style:{animationDelay:"2s",animationDuration:"5s"}}),e.jsx("div",{className:"absolute bottom-20 right-20 w-10 h-10 bg-green-300/30 rounded-full animate-bounce",style:{animationDelay:"0.5s",animationDuration:"3.5s"}}),e.jsx("div",{className:"absolute top-60 left-32 w-8 h-8 bg-purple-300/30 rounded-full animate-bounce",style:{animationDelay:"1.5s",animationDuration:"4.5s"}}),e.jsx("div",{className:"absolute top-32 right-1/4 w-14 h-14 bg-orange-300/30 rounded-full animate-bounce",style:{animationDelay:"2.5s",animationDuration:"3.8s"}}),e.jsx("div",{className:"absolute top-24 left-1/4 text-yellow-300/70 text-2xl animate-pulse",style:{animationDuration:"2s"},children:"‚≠ê"}),e.jsx("div",{className:"absolute top-48 right-1/3 text-yellow-300/70 text-xl animate-pulse",style:{animationDuration:"3s"},children:"‚ú®"}),e.jsx("div",{className:"absolute bottom-60 left-1/2 text-yellow-300/70 text-3xl animate-pulse",style:{animationDuration:"2.5s"},children:"üåü"}),e.jsx("div",{className:"absolute top-72 left-24 text-yellow-300/70 text-lg animate-pulse",style:{animationDuration:"4s"},children:"üí´"}),e.jsx("div",{className:"absolute bottom-40 right-1/3 text-yellow-300/70 text-2xl animate-pulse",style:{animationDuration:"3.5s"},children:"‚≠ê"}),e.jsx("div",{className:"absolute top-1/2 right-16 text-yellow-300/70 text-xl animate-pulse",style:{animationDuration:"2.8s"},children:"‚ú®"})]}),e.jsxs("div",{className:"w-full max-w-md mx-4 relative z-10",children:[e.jsxs(U,{className:"bg-white/95 backdrop-blur-sm shadow-2xl rounded-3xl border-0 overflow-hidden",children:[e.jsxs("div",{className:"text-center py-6 px-6",children:[e.jsx("img",{src:"https://static.readdy.ai/image/90aee2f41c3492197bc6a5939c00cef4/41af0e5a6d49213fb975fa0447bec3cd.png",alt:"Profeta de Deus Kids",className:"h-16 mx-auto mb-4 object-contain"}),e.jsx("h2",{className:"text-lg text-gray-600 font-medium",children:d?"Entre na sua conta":"Criar nova conta"})]}),e.jsx("div",{className:"px-6 pb-6",children:e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsx(z,{type:"email",placeholder:"Digite seu email",value:p,onChange:t=>P(t.target.value),required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-xl text-gray-700 placeholder-gray-500 focus:bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:border-gray-400 transition-all"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{type:_?"text":"password",inputMode:"numeric",placeholder:d?"Digite seu CPF":"Digite seu CPF (ser√° sua senha)",value:N,onChange:t=>C(M(t.target.value)),onKeyDown:t=>{!["Backspace","Tab","ArrowLeft","ArrowRight","Delete","Enter"].includes(t.key)&&!/^\d$/.test(t.key)&&t.preventDefault()},required:!0,className:"w-full px-4 py-3 bg-gray-50 border-2 border-gray-300 rounded-xl text-gray-700 placeholder-gray-500 focus:bg-white focus:ring-2 focus:ring-purple-500 focus:border-purple-500 hover:border-gray-400 transition-all pr-12"}),e.jsx("button",{type:"button",onClick:()=>V(t=>!t),"aria-label":_?"Ocultar CPF":"Mostrar CPF",className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:e.jsx("i",{className:_?"ri-eye-off-line text-xl":"ri-eye-line text-xl"})})]}),d&&e.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[e.jsx("input",{type:"checkbox",id:"rememberMe",checked:j,onChange:t=>O(t.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"rememberMe",className:"text-sm text-gray-600",children:"Lembrar de mim neste dispositivo"})]}),e.jsx(h,{type:"submit",disabled:E,className:"w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-3 rounded-xl border-0 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 whitespace-nowrap",children:E?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),d?"Entrando...":"Criando conta..."]}):d?"Entrar":"Criar Conta"}),e.jsxs(h,{type:"button",onClick:()=>u("/como-navegar"),className:"w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold py-3 rounded-xl border-0 shadow-lg hover:shadow-xl transform hover:scale-[1.02] transition-all duration-300 whitespace-nowrap",children:[e.jsx("i",{className:"ri-play-circle-line mr-2"}),"Como Navegar pelo Site"]}),e.jsxs("div",{className:"text-center pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:d?"N√£o tem uma conta?":"J√° tem uma conta?"}),e.jsx(h,{type:"button",onClick:()=>{d?u("/comprar-licenca"):$(!0)},variant:"secondary",className:"bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium px-6 py-2 rounded-lg border border-gray-300 hover:border-gray-400 transition-all whitespace-nowrap",children:d?"Criar Conta":"Fazer Login"})]})]})})]}),e.jsx(re,{message:"Ol√°! Preciso de ajuda com o login no Profeta de Deus Kids"}),e.jsx("div",{className:"text-center mt-6",children:e.jsx("p",{className:"text-white/80 text-sm drop-shadow",children:"Acesso seguro com controle de dispositivos por licen√ßa"})})]}),e.jsx("style",{children:`
        @keyframes gradientShift {
          0% { background-position: 0% 50%; }
          25% { background-position: 25% 50%; }
          50% { background-position: 50% 50%; }
          75% { background-position: 75% 50%; }
          100% { background-position: 100% 50%; }
        }
      `})]})}export{de as default};
